# 第 6 章 最後的防線：Hook

## 6-1 什麼是 Hook？

- [範例專案：todo_system](https://github.com/FlagTech/F5757_ch06_todo-system)

    ```
    https://github.com/FlagTech/F5757_ch06_todo-system.git
    ```

## 6-2 建立第一個 Hook - PostToolUse hook 追蹤指定檔案

- 輸入的提示內容：
    ```
    我已經在這個專案中建立好一個 PostUsetool hook, 但 post_desktop_notify_hook.py 這個程式還未設計, 請依照我的要求設計出這個程式：

    希望這個程式能有個『追蹤檔案清單』, 每當 Claude Code 修改檔案時, 這個程式就會根據傳入的 JSON 資料取得檔案名稱並與『追蹤檔案清單』進行比對, JSON 資料格式如下：

    {
      "session_id": "",
      "transcript_path": "",
      "cwd": "",
      "permission_mode": "",
      "hook_event_name": "",
      "tool_name": "Edit",
      "tool_input": {
        "file_path": "",
        (…略)
      },
      "tool_response": {
        "filePath": "",
        (…略)
    }

    如果有吻合就代表 Claude Code 修改到指定的檔案, 才發送桌面通知提醒我, 請使用notifypy 來設計, 並且我是用 uv 工具來管理專案, 所以請使用 uv 來操作
    ```

- [6-2 發送桌面通知_範例程式&相關檔案](https://github.com/FlagTech/F5757_ch06_02)

    ```
    https://github.com/FlagTech/F5757_ch06_02.git
    ```

## 6-3 建立 Notification Hook – 在 LINE 上收到提醒通知

- 輸入的提示內容：
    ```
    我已經在這個專案中建立好一個 Notification hook，但notification_line_hook.py這個程式還未設計，請依照我的要求設計出這個程式：

    我希望這個程式能夠接收 Claude Code 的通知事件，當 Claude Code 發送通知時，將通知訊息轉發到我的 LINE帳號。程式會根據傳入的 JSON 資料取得通知訊息，JSON資料格式如下：

    {
      "session_id": "",
      "transcript_path": "",
      "cwd": "",
      "permission_mode": "",
      "hook_event_name": "Notification",
      "message": "通知訊息內容",
      (…略)
    }

    程式需要：
    1. 只處理 hook_event_name 為 "Notification" 的事件
    2. 從 .env 檔案讀取 LINE_CHANNEL_ACCESS_TOKEN 和LINE_USER_ID
    3. 使用 LINE的 MessagingApi 發送推播訊息

    並且我是用 uv 工具來管理專案，所以請使用 uv 來操作。同時請建立 .env 檔案來儲存 LINE 設定。
    ```

- [6-3 發送LINE通知_範例程式&範例檔案](https://github.com/FlagTech/F5757_ch06_03)

    ```
    https://github.com/FlagTech/F5757_ch06_03.git
    ```

## 6-4 從追蹤檔案轉為保護檔案 Hook

- 輸入的提示內容：
    ```
    幫我根據 post_desktop_notify_hook.py 建立一個新的程式, 只要修改檔案在追蹤清單中, 除了發送桌面通知, 也要回傳退出代碼2與使用英文輸出錯誤訊息, 在Claude Code 使用工具前, 阻止檔案被修改並告知錯誤
    ```

- [6-4 阻擋工具使用_範例程式](https://github.com/FlagTech/F5757_ch06_04)

    ```
    https://github.com/FlagTech/F5757_ch06_04.git
    ```
